# <span style="color:#09f">📍11-24 SQL 구현 STUDY </span>

**UPPER: 대문자**   
**LOWER: 소문자**   
**INITCAP: 앞글자만 대문자**   
**TRIM: 공백제거**   
**LTRIM: 왼쪽 공백제거**   
**RTRIM: 오른쪽 공백제거**   
**SUBSTR(문자열, 시작위치, 길이): 문자열 자르기**   
**LENGTH(문자열): 문자열 길이 반환**
**TO_CHAR(날짜, '포맷'): 날짜를 문자형으로 변환**

```SQL
UPPER('hoho') -> "HOHO"
LOWER('HOHO') -> "hoho"
INITCAP('hoho') -> "Hoho"
TRIM('   ho ho   ') -> "ho ho"
LTRIM('   ho ho   ') -> "ho ho   "
RTRIM('   ho ho   ') -> "   ho ho"
SUBSTR('abcdefgh', 3, 4) -> "cdef"
LENGTH('hello world') -> 11
TO_CHAR(DATE '2023-11-24', 'YYYY-MM-DD') -> "2023-11-24"
TO_CHAR(DATE '2023-11-24', 'MM/DD/YYYY') -> "11/24/2023"
TO_CHAR(DATE '2023-11-24', 'DY') -> "FRI"
TO_CHAR(DATE, 'HH24:MI:SS') -> "00:00:00"
TO_CHAR(DATE, 'mm') -> "11" // 2023-11-24 기준
```

		
**COALESCE(a, b): a가 null이면 b 반환**    
```SQL
SELECT PT_NAME, PT_NO, GEND_CD, AGE, COALESCE(TLNO, 'NONE') AS TLNO   
FROM PATIENT
WHERE AGE <= '12' AND LOWER(GEND_CD) = 'w'
ORDER BY AGE DESC, PT_NAME ASC;
```

**오라클에서는 A와 B가 같지 않음을 나타낼때 != 말고 <span style=color:red><></span> 이게 표준!**

**null인 요소는 WHERE 문에서 컬럼 명 옆에 IS NOT NULL** / IS NULL**    
```SQL   
SELECT MEMBER_ID, MEMBER_NAME, GENDER, TO_CHAR(DATE_OF_BIRTH, 'yyyy-mm-dd')
FROM MEMBER_PROFILE
WHERE GENDER = 'W' AND TO_CHAR(DATE_OF_BIRTH, 'MM') = '03'
AND TLNO IS NOT NULL
ORDER BY MEMBER_ID;
```

**CASE문(컬럼/조건식 기준)**
- 컬럼 기준
```SQL
CASE 컬럼명
    WHEN 값1 THEN 결과1
    WHEN 값2 THEN 결과2
    ELSE 결과기본
END   
```

- 조건식 기준
```SQL
CASE
    WHEN 조건1 THEN 결과1 // WHEN AGE < 13 THEN '초딩이요'
    WHEN 조건2 THEN 결과2
    ELSE 결과기본
END
```


```SQL
SELECT BOARD_ID, WRITER_ID, TITLE, PRICE, 
CASE STATUS WHEN 'SALE' THEN '판매중' WHEN 'RESERVED' THEN '예약중' ELSE '거래완료' END AS STATUS
FROM USED_GOODS_BOARD
WHERE TO_CHAR(CREATED_DATE, 'YYYY-MM-DD') = '2022-10-05'
ORDER BY BOARD_ID DESC;
```


---
### <기습 프로그래머스 2단계 문제>    
PRODUCT 테이블과 OFFLINE_SALE 테이블에서 상품코드 별 매출액(판매가 * 판매량) 합계를 출력하는 SQL문을 작성해주세요.   
결과는 매출액을 기준으로 내림차순 정렬해주시고 매출액이 같다면 상품코드를 기준으로 오름차순 정렬해주세요.**

```SQL
SELECT P.PRODUCT_CODE, SUM(P.PRICE * S.SALES_AMOUNT) AS SALES
FROM PRODUCT P
JOIN OFFLINE_SALE S
ON P.PRODUCT_ID = S.PRODUCT_ID
GROUP BY P.PRODUCT_CODE
ORDER BY SALES DESC, P.PRODUCT_CODE ASC;
```

**GROUP BY는 언제 쓰는가?**
- 집계 함수(SUM, COUNT, AVG, MAX, MIN 등)를 사용
- 특정 기준(예: 상품코드, 회원ID, 부서ID 등)으로 데이터를 묶어서 그룹별 합계/평균/개수를 구하고 싶을 때

```SQL
SELECT DEPT_ID, AVG(SALARY)
FROM EMPLOYEE
GROUP BY DEPT_ID;
```

👉 DEPT_ID별로 그룹을 만들고, 그 그룹 안에서 평균 급여를 계산합니다.   
-> DEPT_ID는 집계함수가 아니라서 출력 시 GROUP BY로 묶어주어야함!